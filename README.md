# 2fa-js

Simple and light weight utility to generate one time password based on HMAC Digestion (**HOTP**) and Time counter (**TOTP**). This utility also provides option to generate a qrcode and secret code for setting up the counter in user device using an authentication apps such as *Google Authenticator, Microsoft Authenticator, Okto* etc.

<!-- ## Getting Started

Install using npm

`npm i 2fa-js` -->

## Available Modules

`totp`, `hotp`, `qrGenerator`

## How it works?

This generates Secret using HMAC Digestion with `sha1` digestion module in compliance to `RFC 6238` Standards for TOTP Generation. The token generated by this module will be of `6 digits`. Future supports for other digestion modules and extra digits will be extended.

## Usage

### qrGenerator

This function could be used in the below two scenarios,

1.	**New Registration** - The user account is enabled for first time to utlize totp authentication.
2.	**Device lost Recovery** - When the user looses his device and want to recover the counter in new device, or if the user is changing the device then they could recover the counter using this option

***Note:*** Device lost recovery is done using the same secret token tagged to the user. It is not a `security standard`, and always recommended to create a new secret token for device recovery or change in device.

This function expects two mandatory parameters `app_identifier` and `user_identifier` to differntiate the counters running in the authenticator app.

In addition, you could send `options.secret` and `options.reset` to support device recovery with pre-existing secret token. Before using this please read `**Note**` provided above.

#### New Registration

```
const totp, { qrGenerator } = require('2fa-js');

async function QrCode() {
	const result = await qrGenerator('Your app Identifier', 'Your user identifier');

	//The result will have two elements qr_image (dataURI to generate QR Image and b32_token which could be supplied to user for manual entry to attain counter);

	console.log(result.qr_image); //Prints the dataURI to be embedded in img src
	console.log(result.b32_token); //Prints the public key using which dataURI is generated, for manual entry
```
The `qr_image` dataURI could be embedded to the `src` of `img` tag to generate the qrImage.

You are all set now. The couter generated by this secret will work in all the authenticator apps which are developed inline to the `RFC 6238` Standards.

#### Device Recovery with Existing Secret

```
const totp, { qrGenerator } = require('2fa-js');

async function QrCode() {
	const result = await qrGenerator('Your app Identifier', 'Your user identifier', {secret: 'Your Secret', reset: true});

	//The reset options are defaulted to false and it is mandatory to set reset as true to re-generate qr image with existing secret

	console.log(result.qr_image); //Prints the dataURI to be embedded in img src
	console.log(Results.b32_token); //Prints the public key using which dataURI is generated, for manual entry
}
```

The result will have two parameters `qr_image` and `b32_token` as mentioned above.


### TOTP Validation

Once the user registers his device for the qr_code with an authenticator app, it is essential to validate the totp provided by the user with the token generated by the private key maintained in the server at any particular time.

totp function accepts two mandatory parameters `token` and `secret`, and two optional parameters `window_time` and `prev_token`
```
const totp = require('2fa-js');

async function provideTOTP() {
	const result = await totp('Token entered by the user', 'private key corresponding to the user');

	console.log(result); //Prints true or false

	//If returned true, then the token provided by the user is matching with the counter running in server for that user
	//If returned false, then token and server counter doesn't match or atleast the user entered the code out of window period
}

```

The above function uses a default `window_time`, which could be changed if required, by passing the optional parameter.

```
const totp = require('2fa-js');

async function provideTOTP() {
	const result = await totp('Token entered by the user', 'private key corresponding to the user', {window_time: 1});

	console.log(result); //Prints true or false
	
}

```

**Security Note**: For security reasons, it is always advised not to increase the `window_time` to more than 1.

For added security, and for first time confirmation, there is a general practice to request user to enter two consecutive tokens, which could be acheived likewise by passing an optional parameter `prev_token`


```
const totp = require('2fa-js');

async function provideTOTP() {
	const result = await totp('Token entered by the user', 'private key corresponding to the user', {window_time: 0, prev_token: 'Previous token by the user'});

	console.log(result); //Prints true or false
	
}

```

## License

The MIT License (**MIT**)

## Custom Support

Please contact us at vimal.r.100@gmail.com to get a custom support of this product or any other security compliances or cryptographic requirements of your digital products
